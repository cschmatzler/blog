---
import { getCollection } from "astro:content";
import PageLayout from "../../layouts/PageLayout.astro";
import PageMeta from "../../components/PageMeta.astro";

export async function getStaticPaths({ paginate }) {
  const posts = await getCollection("posts");
  const sortedPosts = posts
    .sort(
      (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
    );

  return paginate(sortedPosts, { pageSize: 5 });
}

const { page } = Astro.props; 

---

<PageLayout>
  <Fragment slot="meta">
    <PageMeta title={`Posts | The Medium Place`} />
    <link
      rel="alternate"
      type="application/rss+xml"
      title=".rss"
      href="/rss.xml"
    />
  </Fragment>
  <section slot="main">
    <ul class="space-y-6">
      {
        page.data.map((post) => {
          const formattedDate = new Date(post.data.date).toLocaleDateString(
            "en-gb",
            {
              year: "numeric",
              month: "short",
              day: "numeric",
            }
          );

          return (
            <li class="flex">
              <div class="flex-grow text-xl">
                <a href={`/post/${post.slug}`}>{post.data.title}</a>
              </div>
              <div class="font-light text-overlay flex-shrink-0 ml-6">
                <time datetime={post.data.date.toISOString()}>
                  {formattedDate}
                </time>
              </div>
            </li>
          );
        })
      }
    </ul>
  </section>
</PageLayout>

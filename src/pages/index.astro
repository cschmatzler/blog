---
import { getCollection } from "astro:content";
import PageLayout from "../layouts/PageLayout.astro";
import PageMeta from "../components/PageMeta.astro";

const allPosts = await getCollection("posts", ({ data }) => {
  return data.draft === false;
});
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf()
);
const posts = sortedPosts.slice(0, 2);
---

<PageLayout>
  <PageMeta title="The Medium Place" slot="meta" />
  <Fragment slot="main">
    <h1
      class="bg-gradient-to-br from-pink to-yellow bg-clip-text text-3xl font-extrabold text-transparent sm:text-5xl"
    >
      The Medium Place
    </h1>

    <section class="mt-4">
      <ul class="flex flex-col divide-y divide-sky">
        {
          posts.map((post) => {
            const formattedDate = new Date(post.data.date).toLocaleDateString(
              "en-gb",
              {
                year: "numeric",
                month: "short",
                day: "numeric",
              }
            );

            return (
              <li class="flex flex-col">
                <a
                  href={`/post/${post.slug}`}
                  class="my-6 px-6 py-8 rounded-lg hover:bg-crust hover:ring-2 hover:ring-lavender"
                >
                  <div class="flex flex-col sm:flex-row-reverse sm:items-center">
                    <div class="font-light text-overlay flex-shrink-0 sm:ml-6">
                      <time datetime={post.data.date.toISOString()}>
                        {formattedDate}
                      </time>
                    </div>
                    <span class="flex-grow text-2xl mt-2 sm:m-0">
                      {post.data.title}
                    </span>
                  </div>
                  <p class="mt-5 prose text-subtext text-lg">
                    {post.data.description}
                  </p>
                </a>
              </li>
            );
          })
        }
      </ul>
    </section>

    <section class="mt-12 w-full sm:flex sm:justify-center sm:pl-52">
      <div class="mt-18 flex max-w-sm flex-shrink-0 flex-col rounded-lg bg-mantle p-8 ring-4 ring-teal sm:relative sm:mb-12 mx-auto">
        <p class="z-10 text-lg text-subtext sm:text-xl">
          <span>Hi! I'm Christoph, and I write stuff.</span>
          <span>
            Somewhere inbetween literal heaven and hell, unable to decide whether
            this is finally an attempt at creating a professional presence, an
            outlet for writing practice or wanting to micro-blog about whatever I
            had for dinner last night, you are definitely in for a surprise with
            every link you follow.
          </span>
        </p>
        <div class="absolute inset-0 -left-[11.25rem] top-48 hidden h-48 rounded-md sm:flex">
          <img src="/images/face.jpg" class="h-48 w-48 rounded-md object-cover ring-8 ring-rosewater" />
        </div>
      </div>
    </section>
  </Fragment>
</PageLayout>
